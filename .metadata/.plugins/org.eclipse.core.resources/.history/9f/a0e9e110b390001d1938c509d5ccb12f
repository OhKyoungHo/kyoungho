package com.example.controller;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.example.domain.MemberVO;
import com.example.domain.WishListVO;
import com.example.persistence.WishListRepository;
import com.example.service.WishListServiceImpl;

@Controller
@RequestMapping("/mypage")
public class MypageController {

	@Autowired
	private WishListRepository wishRepo;
	@Autowired
	private WishListServiceImpl wishService;


	@RequestMapping("/wishlistaca")
	public void wishListaca(Model m) {
		m.addAttribute("wishList", wishRepo.getWishList());

	}

//	//좋아요 버튼
//	@PostMapping("/like")
//	public @ResponseBody int like(Integer edId, String memId) {
//		int result = wishService.saveLike(edId, memId);
//		return result;
//	}
	
	// 장바구니 추가
	@RequestMapping("/insert.do")
	public String wishInsert(@ModelAttribute WishListVO vo, HttpSession session) {
		MemberVO user_id = (MemberVO) session.getAttribute("memId");
		//System.out.println(user_id);
		vo.setMemId(user_id);
		// 장바구니에 기존 상품이 있는지 검사
		//System.out.println(vo.getProduct_number());
		int count = wishService.countCart(vo.getEdId(), user_id);
		// (count == 0) ? cartService.updateCart(vo) : cartService.cartInsert(vo);
		if (count == 0) {
			// 없으면 insert
			cartService.cartInsert(vo);
		} else {
			// 있으면 update
			cartService.updateCart(vo);
		}
		return "redirect:/cart/cartList.do";
	}



}
